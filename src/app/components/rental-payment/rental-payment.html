<div class="container">
    <!-- Header -->
    <header class="header">
        <button class="back-btn" (click)="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <div class="header-center">
            <span class="booking-id">{{ userId }}</span>
        </div>
        <button class="notification-btn" (click)="openNotifications()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="dot"></span>
        </button>
    </header>

    <div class="content">
        <h1 class="page-title">Rental Payment</h1>

        <!-- Total Summary -->
        @if(!loading && pendingInvoices.length > 0) {
        <div class="total-summary">
            <span class="total-label">Total Due</span>
            <span class="total-value">₹{{ totalAmount | number:'1.0-0' }}</span>
        </div>
        }

        <!-- Loading -->
        @if(loading) {
        <div class="loading-state">
            <p>Loading invoices...</p>
        </div>
        }

        <!-- Error -->
        @if(error) {
        <div class="error-state">
            <p>{{ error }}</p>
            <button class="retry-btn" (click)="loadPendingInvoices(userId)">Retry</button>
        </div>
        }

        <!-- No Pending Invoices -->
        @if(!loading && !error && pendingInvoices.length === 0) {
        <div class="empty-state">
            <div class="empty-icon">✓</div>
            <h3>All Caught Up!</h3>
            <p>No pending invoices. You're all paid up.</p>
        </div>
        }

        <!-- Invoice List -->
        @if(!loading && !error && pendingInvoices.length > 0) {
        <div class="invoice-list">
            @for(invoice of pendingInvoices; track invoice.id) {
            <div class="invoice-card" [class.overdue]="invoice.status === 'Overdue'">

                <div class="invoice-header">
                    <div class="invoice-info">
                        <span class="invoice-number">{{ invoice.invoice_number || 'Invoice' }}</span>
                        <span class="invoice-status" [class.status-overdue]="invoice.status === 'Overdue'"
                            [class.status-sent]="invoice.status === 'Sent'">
                            {{ invoice.status || 'Sent' }}
                        </span>
                    </div>
                    <span class="invoice-amount">₹{{ invoice.numericTotal | number:'1.0-0' }}</span>
                </div>

                <div class="invoice-details">
                    <div class="detail-row">
                        <span class="detail-label">Due Date</span>
                        <span class="detail-value">{{ formatDueDate(invoice.due_date) }}</span>
                    </div>
                    @if(invoice.numericBalance && invoice.numericBalance > 0) {
                    <div class="detail-row">
                        <span class="detail-label">Balance</span>
                        <span class="detail-value">₹{{ invoice.numericBalance | number:'1.2-2' }}</span>
                    </div>
                    }
                </div>

                <button class="btn-pay-invoice" (click)="payInvoice(invoice)"
                    [disabled]="processingInvoiceId === invoice.id">
                    <span class="btn-text">
                        {{ processingInvoiceId === invoice.id ? 'Opening...' : 'Pay now →' }}
                    </span>
                </button>
            </div>
            }
        </div>
        }
    </div>

    <!-- Footer -->
    <div class="footer">
        <button class="btn-raise-issue" (click)="raiseIssue()">Raise an issue</button>
    </div>
</div>
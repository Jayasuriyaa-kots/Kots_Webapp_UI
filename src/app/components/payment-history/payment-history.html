<div class="payment-history-container">
    <header class="header">
        <button class="back-btn" (click)="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <div class="header-center">
            <span class="booking-id">{{currentBookingId || 'Loading...'}}</span>
        </div>
        <button class="notification-btn" (click)="openNotifications()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="dot"></span>
        </button>
    </header>

    <!-- Scrollable Content -->
    <section class="content-section">
        <h1 class="page-title">Rental Invoice History</h1>
        <a href="#" class="subtitle-link">Services invoice history</a>

        <!-- Loading -->
        @if(loading) {
        <div class="loading-state">
            <p>Loading invoices...</p>
        </div>
        }

        <!-- Error -->
        @if(error) {
        <div class="error-state">
            <p>{{ error }}</p>
            <button class="retry-btn" (click)="loadInvoices(currentBookingId)">Retry</button>
        </div>
        }

        <!-- Invoice List -->
        @if(!loading && !error) {
        <div class="history-list">
            @if(invoices.length === 0) {
            <div class="empty-state">
                <p>No invoices found for this booking.</p>
            </div>
            }

            @for(invoice of invoices; track invoice.id) {
            <div class="history-item">
                <div class="icon-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                </div>
                <div class="item-details">
                    <h3 class="item-title">Rent Payment</h3>
                    <p class="item-date">{{ formatDueDate(invoice.due_date).month }} {{
                        formatDueDate(invoice.due_date).year
                        }}</p>
                    <p class="item-status" [class.status-ontime]="invoice.status === 'Paid'"
                        [class.status-late]="invoice.status === 'Overdue'">
                        @if(invoice.status === 'Paid' && invoice.updated_at) {
                        <span>Paid on {{ formatDate(invoice.updated_at) }}</span>
                        }
                        @if(invoice.status === 'Overdue') {
                        <span>Overdue</span>
                        }
                        @if(invoice.status && invoice.status !== 'Paid' && invoice.status !== 'Overdue') {
                        <span>{{ invoice.status }}</span>
                        }
                    </p>
                </div>
                <button class="download-btn" (click)="downloadInvoice(invoice.id)" [disabled]="!invoice.pdf_url">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#a6942e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
            </div>
            }
        </div>
        }
    </section>
</div>
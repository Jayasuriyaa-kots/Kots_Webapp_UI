<div class="container">
    <!-- Header -->
    <header class="header">
        <button class="back-btn" (click)="goBack()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="white" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <div class="header-center">
            <span class="booking-id">{{ userId }}</span>
        </div>
        <button class="notification-btn" (click)="openNotifications()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="dot"></span>
        </button>
    </header>

    <h1 class="page-title">Car Parking</h1>

    <!-- Loading -->
    <div class="main-content" *ngIf="isLoading">
        <p class="loading-text">Checking parking status...</p>
    </div>

    <!-- STATE 1: No parking record — show request flow -->
    <div class="main-content" *ngIf="!isLoading && hasNoParkingRecord">
        <!-- Disclaimer -->
        <div class="disclaimer-box">
            <div class="disclaimer-icon">⚠️</div>
            <h3 class="disclaimer-title">Terms & Conditions</h3>
            <ul class="disclaimer-list">
                <li>Parking is only assigned if slots are available.</li>
                <li>Once parking is added to the contract, the rent shall increase as per the contract and it cannot be
                    cancelled during the contract.</li>
                <li>Only one car slot is allotted per flat.</li>
            </ul>
        </div>

        <!-- Image -->
        <div class="illustration-container">
            <img src="assets/images/carparking.png" alt="Car Parking" class="illustration">
        </div>

        <!-- Error -->
        <p class="error-text" *ngIf="requestError">{{ requestError }}</p>
    </div>

    <!-- STATE 3: In waiting list -->
    <div class="main-content" *ngIf="!isLoading && !hasNoParkingRecord && waitingListNumber > 0">
        <div class="illustration-container">
            <img src="assets/images/carparkingwaiting.png" alt="Car Parking Waiting" class="illustration">
        </div>

        <h2 class="status-title">You're in the waiting list</h2>
        <p class="status-message-green">Your waiting list No. <strong>{{ waitingListNumber }}</strong></p>
    </div>

    <!-- Footer -->
    <div class="footer">
        <!-- Before request: show active Request button -->
        <button class="btn-request" *ngIf="hasNoParkingRecord && !requestSent" (click)="requestParking()"
            [disabled]="isSendingRequest">
            {{ isSendingRequest ? 'Sending request...' : 'Request for Car Parking' }}
        </button>

        <!-- After request sent: show disabled Sent Request + Cancel Request -->
        <button class="btn-sent-request" *ngIf="hasNoParkingRecord && requestSent" disabled>
            Sent Request
        </button>
        <button class="btn-cancel-request" *ngIf="hasNoParkingRecord && requestSent" (click)="cancelRequest()"
            [disabled]="isCancelling">
            {{ isCancelling ? 'Cancelling...' : 'Cancel Request' }}
        </button>

        <button class="btn-home" *ngIf="!hasNoParkingRecord" (click)="goBack()">Go back</button>
    </div>
</div>